---
title: FOSS For Spectroscopy
author: Bryan A. Hanson, DePauw University
date: "`r Sys.Date()`"
output:
  html_document:
    theme: united
---


<!-- See https://kryogenix.org/code/browser/sorttable/ -->
<script src="sorttable.js"></script>

The following table collects information about free and open source software ([FOSS](https://en.wikipedia.org/wiki/Free_and_open-source_software)) for spectroscopy.  All information is taken from the respective websites and/or repositories.  Some softwares have been described in publications.  If so, a link is provided but keep in mind the document may be behind a paywall.

Unless otherwise noted, the software mentioned here:

* Is suitable for one or more of the following techniques: NMR, IR, Raman, ESR/EPR, fluorescence and UV-Vis.
* Mass *spectrometry* software is not included.
* Software for MRI is not included.

[Stanstrup *et al.*](https://www.mdpi.com/2218-1989/9/10/200) have published a comprehensive paper describing the `R` packages suitable for use in metabolomics, which partially overlaps with the information here.

The [CRAN Task View for Chemometrics & Computational Physics](https://cran.r-project.org/web/views/ChemPhys.html) includes some `R` packages listed here as well as related software.

Additions or corrections?  Please [file an issue](https://github.com/bryanhanson/FOSS4Spectroscopy/issues) with the necessary information or submit a pull request at the [repo](https://github.com/bryanhanson/FOSS4Spectroscopy).

[![Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
[![Build Status](https://travis-ci.com/bryanhanson/FOSS4Spectroscopy.svg?branch=master)](https://travis-ci.com/bryanhanson/FOSS4Spectroscopy)


```{r setupR, echo = FALSE, results = "hide"}
# Clean up the workspace but keep the token
keep <- "github_token"
rm(list = ls()[!(ls() %in% keep)])

suppressPackageStartupMessages(library("knitr"))
suppressPackageStartupMessages(library("kableExtra"))
suppressPackageStartupMessages(library("readxl"))
suppressPackageStartupMessages(library("httr"))
suppressPackageStartupMessages(library("lubridate"))
suppressPackageStartupMessages(library("jsonlite"))

opts_chunk$set(echo = FALSE)

source("getGHdates.R") # function to get GH most recent commit dates

# Python library for finding modifed/creation dates
# http://adrien.barbaresi.eu/blog/python-extract-date-web-pages.html
# For the types of sites encountered here, this library does not do
# a great job, so we'll only use it if we have nothing better to try
suppressPackageStartupMessages(library("reticulate"))
py_install("htmldate")

cnt <- 0L # counter for the number of GET calls to Github
```


```{r readDB}
# Please edit FOSS4Spec.xlsx to add information or make corrections.
# Please follow the conventions of existing entries for consistency.
# Remember the table in the web page is sortable so consistency in
# description and notes is especially important for users to obtain
# useful information.

DF <- read_excel("FOSS4Spec.xlsx")
DF <- as.data.frame(DF)
# shorten names for less typing
names(DF) <- c("name", "web", "repo", "pub", "lang", "desc", "notes")

# TEMPORARY: just use a few lines for faster testing & not blasting GH limits
#DF <- DF[1:3,]
```

```{r GHaccess, eval = FALSE}
# Try to retrieve the token and if succsessful, prep the access string & login
# See https://developer.github.com/v3/#authentication
token_found <- FALSE
token <- Sys.getenv("TRAVIS_CI")
if (token != "") token_found <- TRUE # doesn't mean it's the right token however!
if (!token_found) message("Could not retrieve token - GET calls will be rate-limited by Github")
if (token_found) {
  gh_access_string <- paste("bryanhanson:", token, " https://api.github.com/bryanhanson", sep = "")
  response <- system2("curl", args = c("-u", gh_access_string), stdout = TRUE, stderr = TRUE)
  if (any(grepl("Bad credentials", response))) message("Github access denied; perhaps the token was wrong")
  set_config(config(token = token)) # applies to all GET requests
}

```

```{r GHaccess2}
# Set this token up ahead of time, so it is in the environment
set_config(config(token = github_token)) # applies to all GET requests
```

```{r verifyURLs}
# This takes some time!
ne <- nrow(DF) # number of entries

# Check all URLs, if the site is down handle so table always looks good.
# Site URL might also just be missing from table, handle this too.
webLink <- rep(FALSE, ne) # If TRUE, there is a link in the input table
repoLink <- rep(FALSE, ne)
pubLink <- rep(FALSE, ne)

webOK <- rep(FALSE, ne) # If TRUE, URL was reachable
repoOK <- rep(FALSE, ne)
pubOK <- rep(FALSE, ne)

badWeb <- rep(FALSE, ne) # If TRUE, URL was given but not reachable: report it
badRepo <- rep(FALSE, ne)
badPub <- rep(FALSE, ne)

for (i in 1:ne) {
  if (!is.na(DF$web[i])) {
    webOK[i] <- identical(status_code(GET(DF$web[i])), 200L)
    webLink[i] <- TRUE
    if (webLink[i] != webOK[i]) badWeb[i] <- TRUE
  }

  if (!is.na(DF$repo[i])) {
    repoOK[i] <- identical(status_code(GET(DF$repo[i])), 200L)
    repoLink[i] <- TRUE
    if (repoLink[i] != repoOK[i]) badRepo[i] <- TRUE
  }

  if (!is.na(DF$pub[i])) {
    pubOK[i] <- identical(status_code(GET(DF$pub[i])), 200L)
    pubLink[i] <- TRUE
    if (pubLink[i] != pubOK[i]) badPub[i] <- TRUE
  }
}
# If URLs are bad they will still be added to the table as hyperlinks, but
# those links will give status 404.
# Write a report so maintainers can check & fix
LinkReport <- data.frame(DF$name, webLink, webOK, repoLink, repoOK, pubLink, pubOK, stringsAsFactors = FALSE)
keep <- badPub | badRepo | badWeb
LinkReport <- LinkReport[keep,]
if (nrow(LinkReport) > 0) write.csv(LinkReport, row.names = FALSE, file = "BadLinks.csv")
```

```{r checkUpdateDate}
# Use the info from checking URLs above
webDate <- as.POSIXct(rep(NA, ne)) # see stackoverflow.com/a/33002710/633251
commitDate <- as.POSIXct(rep(NA, ne))
issueDate <- as.POSIXct(rep(NA, ne))
updateDate <- as.POSIXct(rep(NA, ne))

repoType <- rep("xx", ne)
repoType[grepl("github\\.com", DF$repo)] <- "gh"

for (i in 1:ne) {

  if (webOK[i]) {
    tmp <- system2("wget",
      args = c("-qO-", DF$web[i], "|", "htmldate"),
      stdout = TRUE)
    if (length(tmp) == 1L) webDate[i] <- ymd(tmp)
  }

  if (repoOK[i]) {
    if (repoType[i] == "gh") {
      # There is a limit of how often you can hit GH ...
      # https://developer.github.com/v3/#rate-limiting
      # NA returned when repo path bad
      tmp <- getGHdates(DF$repo[i], "commits")
      cnt <- cnt + 1
      if (!is.na(tmp)) commitDate[i] <- ymd(tmp)
      tmp <- getGHdates(DF$repo[i], "issues")
      cnt <- cnt + 1
      if (!is.na(tmp)) issueDate[i] <- ymd(tmp)
    }
  }

  # updateDate will be the most recent of webDate, issueDate, commitDate
  updateDate[i] <- max(webDate[i], commitDate[i], issueDate[i], na.rm = FALSE)
}
updateDate <- date(updateDate) # -> ymd
```

```{r createNamelink}
# Additional processing of the input values
# Combine name, website and pub as available to create hyperlink
namelink <- DF$name # There must be at least a name in the input table
for (i in 1:length(namelink)) {
  if (!is.na(DF$web[i])) {
    namelink[i] <- paste("[", DF$name[i], "](", DF$web[i], ")", sep = "")
  }
  if (!is.na(DF$pub[i])) {
    namelink[i] <- paste(namelink[i], " ([pub](", DF$pub[i], "))", sep = "")
  }
}
```

```{r createTable}
DF2 <- data.frame(namelink, DF$desc, DF$lang, DF$notes, updateDate, stringsAsFactors = FALSE)
names(DF2) <- c("name", "description", "language", "notes", "[status](#status)")
```

<hr>

* *Click on a header to sort the table*
* [Abbreviations](#abbreviations) & terms below the table
* The table currently has `r nrow(DF2)` entries; the majority are `R` (`r length(DF2$language[DF2$language == "R"])`) or `Python` (`r length(DF2$language[DF2$language == "Python"])`).

```{r printTable, results = "asis"}
options(knitr.kable.NA = '')
kable(DF2, table.attr = "class=\"sortable\"") %>%
  kable_styling(c("striped", "bordered", "sortable"))
```
##### Status Column: {#status}

The status column in the table gives the date of the most recent:

* commit to a repository,
* activity on an issue filed in a repository,
* web site update
* submission to an archival network such as CRAN, or

as a proxy for regular maintenance.  **Currently only the first 3 items are automatically checked and they are only checked for Github sites.** Keep in mind that some software is fairly mature and thus an older status date does not necessarily mean the software is not maintained.  Follow the links to the websites for more details.

##### Abbreviations & Terms: {#abbreviations}

* __CRAN:__ [Comprehensive R Archival Network](https://cran.r-project.org/)
* __EDA:__ Exploratory data analysis (unsupervised chemometrics)
* __language:__ Most software is built on several languages. In the table, "language" refers to the language one uses to interact with the software. Some software has partial or complete interactive features.
* __nD NMR:__ n-dimensional NMR, 1D, 2D, 3D etc
* __Python:__ Multipurpose programming language [details](https://www.python.org/about/)
* __R:__ A software environment for statistical computing and graphics [details, platforms](https://www.r-project.org/)
* __VM:__ Virtual machine.  Any of several means of delivering software to run on any computer, such as VirtualBox or Docker containers.
